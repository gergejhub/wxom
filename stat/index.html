<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WX Monitor – Stats</title>
  <link rel="stylesheet" href="../assets/styles.css?v=74.audit"/>
  <link rel="stylesheet" href="styles.css?v=74.audit"/>
</head>
<body>

  <!-- Match the dashboard look & feel -->
  <header class="top top--stat">
    <div class="brand">
      <div class="brand__row">
        <div class="brand__title">WX Monitor / Stats</div>
        <div class="brand__spacer"></div>
        <a class="viewpill viewpill--link" href="../index.html" title="Open dashboard">
          <span class="viewpill__k">DASHBOARD</span>
        </a>
        <a class="viewpill viewpill--link" href="../map.html" title="Open map">
          <span class="viewpill__k">MAP</span>
        </a>
        <a class="viewpill viewpill--link" href="../alerts.html" title="Guide">
          <span class="viewpill__k">GUIDE</span>
        </a>
        <button class="viewpill" id="btnNow" type="button" title="Fetch latest.json now">
          <span class="viewpill__k">REFRESH</span>
          <span class="viewpill__v">NOW</span>
        </button>
      </div>
      <div class="brand__sub">Health, refresh verification, and airport‑level change history stored locally in this browser.</div>
    </div>
  </header>

  <main class="statMain">

    <!-- KPI / health overview -->
    <section class="card statCard">
      <div class="tiles tiles--statKpi" id="kpiTiles">

        <div class="tile tile--stat tile--time" id="tileLatest" data-tip-id="kpi_latest" tabindex="0" role="button" aria-label="Latest dataset details">
          <div class="tile__k">Latest dataset</div>
          <div class="tile__v" id="genAt">–</div>
          <div class="tile__s" id="genAge">–</div>
        </div>

        <div class="tile tile--stat" id="tileHealth" data-tip-id="kpi_health" tabindex="0" role="button" aria-label="Refresh health details">
          <div class="tile__k">Refresh health</div>
          <div class="tile__v" id="verdict">–</div>
          <div class="tile__s" id="verdictSub">–</div>
        </div>

        <div class="tile tile--stat" id="tileAvg" data-tip-id="kpi_avg" tabindex="0" role="button" aria-label="Average interval details">
          <div class="tile__k">Average interval</div>
          <div class="tile__v" id="avgInt">–</div>
          <div class="tile__s" id="avgIntSub">–</div>
        </div>

        <div class="tile tile--stat" id="tileCov" data-tip-id="kpi_cov" tabindex="0" role="button" aria-label="Station coverage details">
          <div class="tile__k">Station coverage</div>
          <div class="tile__v" id="counts">–</div>
          <div class="tile__s" id="countsSub">–</div>
        </div>

      </div>

      <div class="statMetaRow">
        <span class="pill" id="expectedPill">Expected ~10 min updates</span>
        <span class="muted" id="storageNote">Airport history is stored locally in this browser. Keep this page open to build trends.</span>
      </div>

      <div class="statVizGrid">
        <div class="statViz" id="vizRefresh" data-tip-id="trend_refresh" tabindex="0" role="button" aria-label="Refresh trend details">
          <div class="statViz__h">
            <div class="statViz__k">Refresh trend</div>
            <div class="statViz__s muted" id="refreshSub">Intervals between dataset updates (this browser)</div>
          </div>
          <canvas id="sparkRefresh" width="520" height="96"></canvas>
        </div>

        <div class="statViz" id="vizCoverage" data-tip-id="trend_coverage" tabindex="0" role="button" aria-label="Coverage trend details">
          <div class="statViz__h">
            <div class="statViz__k">Coverage trend</div>
            <div class="statViz__s muted" id="coverageSub">Missing METAR / TAF counts over time</div>
          </div>
          <canvas id="sparkCoverage" width="520" height="96"></canvas>
        </div>
      </div>
    </section>

    <!-- Airport stats -->
    <section class="card airportCard">
      <div class="airportHead">
        <div>
          <div class="airportHead__title">Airport statistics</div>
          <div class="airportHead__sub muted">Pick an airport (IATA/ICAO). The cards below show observed values at each dataset refresh (stored locally in this browser).</div>
        </div>
        <div class="airportControls">
          <div class="pickWrap">
            <input id="airportPick" class="input" type="text" placeholder="Type IATA or ICAO…" autocomplete="off" list="airportList"/>
            <datalist id="airportList"></datalist>
            <div class="pickHint muted" id="airportHint">–</div>
          </div>

          <button class="pillbtn" id="pickBasesOnly" type="button" aria-pressed="false" title="Limit the airport picker to BASE airports">BASES ONLY: OFF</button>

          <select id="atlasWindow" class="select" title="Time window">
            <option value="60">Last 60 min</option>
            <option value="120">Last 120 min</option>
            <option value="240" selected>Last 240 min</option>
          </select>
          <select id="atlasDir" class="select" title="Direction filter">
            <option value="ALL" selected>All changes</option>
            <option value="WORSE">Got worse</option>
            <option value="BETTER">Improved</option>
          </select>
        </div>
      </div>

      <div class="airportPinned">
        <div class="airportPinned__left">
          <div class="airportPinned__k">Selected airport</div>
          <div class="airportPinned__title" id="atlasBadges">–</div>

          <div class="trendBox">
            <div id="trendStack" class="metricGrid"></div>
            <div id="trendFallback" class="trendFallback" style="display:none;"></div>
          </div>
        </div>

        <div class="airportPinned__right">
          <div class="airportPinned__k">What happened?</div>
<div id="atlasEvents" class="atlasEvents"></div>
        </div>
      </div>
    </section>

    <!-- Refresh log -->
    <section class="card logCard">
      <div class="logHead">
        <div>
          <div class="logHead__title">Recent refresh log</div>
          <div class="muted">Shows generatedAt changes observed by this browser.</div>
        </div>
      </div>
      <div id="logList" class="logList"></div>
    </section>

  </main>

  <!-- Tooltips (hover + click-to-pin) -->
  <div id="statTip" class="tile-tip" aria-hidden="true"></div>
  <div id="statTipPin" class="tile-tip tile-tip--pin" aria-hidden="true" style="display:none;"></div>

  <script src="app.js?v=74.audit"></script>
</body>
</html>
