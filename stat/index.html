<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WX Monitor – Stats</title>
  <link rel="stylesheet" href="../assets/styles.css?v=79"/>
  <link rel="stylesheet" href="styles.css?v=79"/>
</head>
<body>

  <!-- Match the dashboard look & feel -->
  <header class="top top--stat">
    <div class="brand">
      <div class="brand__row">
        <div class="brand__title">WX Monitor / Stats</div>
        <div class="brand__spacer"></div>
        <a class="viewpill viewpill--link" href="../index.html" title="Open dashboard">
          <span class="viewpill__k">DASHBOARD</span>
        </a>
        <a class="viewpill viewpill--link" href="../map.html" title="Open map">
          <span class="viewpill__k">MAP</span>
        </a>
        <a class="viewpill viewpill--link" href="../alerts.html" title="Guide">
          <span class="viewpill__k">GUIDE</span>
        </a>
        <button class="viewpill" id="btnNow" type="button" title="Fetch latest.json now">
          <span class="viewpill__k">REFRESH</span>
          <span class="viewpill__v">NOW</span>
        </button>
      </div>
      <div class="brand__sub">Health, refresh verification, and airport‑level change history stored locally in this browser.</div>
    </div>
  </header>

  <main class="statMain">

    <section class="card statCard">
      <div class="statGrid">
        <div class="statMetric">
          <div class="statMetric__k">Latest dataset</div>
          <div class="statMetric__v" id="genAt">–</div>
          <div class="statMetric__s" id="genAge">–</div>
        </div>
        <div class="statMetric">
          <div class="statMetric__k">Refresh health</div>
          <div class="statMetric__v" id="verdict">–</div>
          <div class="statMetric__s" id="verdictSub">–</div>
        </div>
        <div class="statMetric">
          <div class="statMetric__k">Average interval</div>
          <div class="statMetric__v" id="avgInt">–</div>
          <div class="statMetric__s" id="avgIntSub">–</div>
        </div>
        <div class="statMetric">
          <div class="statMetric__k">Stations / coverage</div>
          <div class="statMetric__v" id="counts">–</div>
          <div class="statMetric__s" id="countsSub">–</div>
        </div>
      </div>

      <div class="statRow">
        <span class="pill" id="expectedPill">Expected ~10 min updates</span>
        <span class="muted" id="storageNote">Airport history is stored locally in this browser. Keep this page open to build trends.</span>
      </div>

      <div class="statCharts">
        <div class="statChart">
          <div class="statChart__k">Refresh trend</div>
          <div class="statChart__s muted" id="refreshSub">Intervals between dataset updates (this browser)</div>
          <canvas id="sparkRefresh" width="520" height="86"></canvas>
        </div>
        <div class="statChart">
          <div class="statChart__k">Coverage trend</div>
          <div class="statChart__s muted" id="coverageSub">Missing METAR / TAF counts over time</div>
          <canvas id="sparkCoverage" width="520" height="86"></canvas>
        </div>
      </div>
    </section>

    <section class="card airportCard">
      <div class="airportHead">
        <div>
          <div class="airportHead__title">Airport statistics</div>
          <div class="airportHead__sub muted">Pick an airport (IATA/ICAO). The charts below show the observed values at each dataset refresh.</div>
        </div>
        <div class="airportControls">
          <div class="pickWrap">
            <input id="airportPick" class="input" type="text" placeholder="Type IATA or ICAO…" autocomplete="off" list="airportList"/>
            <datalist id="airportList"></datalist>
            <div class="pickHint muted" id="airportHint">–</div>
          </div>
          <select id="atlasWindow" class="select" title="Time window">
            <option value="60">Last 60 min</option>
            <option value="120">Last 120 min</option>
            <option value="240" selected>Last 240 min</option>
          </select>
          <select id="atlasDir" class="select" title="Direction filter">
            <option value="ALL" selected>All changes</option>
            <option value="WORSE">Got worse</option>
            <option value="BETTER">Improved</option>
          </select>
        </div>
      </div>

      <div class="airportPinned">
        <div class="airportPinned__left">
          <div class="airportPinned__k">Selected airport</div>
          <div class="airportPinned__title" id="atlasBadges">–</div>

          <div class="trendBox">
            <div id="trendStack" class="trendStack"></div>
            <div id="trendFallback" class="trendFallback" style="display:none;"></div>
          </div>
        </div>

        <div class="airportPinned__right">
          <div class="airportPinned__k">What happened?</div>
          <div id="atlasEvents" class="atlasEvents"></div>
        </div>
      </div>
    </section>

    <section class="card logCard">
      <div class="logHead">
        <div class="logHead__title">Recent refresh log</div>
        <div class="muted">Shows generatedAt changes observed by this browser.</div>
      </div>
      <div class="logTable">
        <table>
          <thead><tr><th>Time</th><th>generatedAt</th><th>Stations</th><th>Missing METAR</th><th>Missing TAF</th></tr></thead>
          <tbody id="logBody"></tbody>
        </table>
      </div>
    </section>

  </main>

  <script src="app.js?v=79"></script>
</body>
</html>
